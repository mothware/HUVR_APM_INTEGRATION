@{
    ViewData["Title"] = "Dashboard";
}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">HUVR API Methods</h3>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Entity Type</label>
                        <select id="entityType" class="form-select">
                            <option value="">-- Select Entity --</option>
                            <option value="assets">Assets</option>
                            <option value="projects">Projects (Work Orders)</option>
                            <option value="defects">Defects (Findings)</option>
                            <option value="measurements">Measurements</option>
                            <option value="inspectionmedia">Inspection Media</option>
                            <option value="checklists">Checklists (Digital Forms)</option>
                            <option value="users">Users</option>
                            <option value="workspaces">Workspaces</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Method</label>
                        <select id="method" class="form-select">
                            <option value="">-- Select Method --</option>
                            <option value="list">List All</option>
                            <option value="get">Get by ID</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">ID (for Get method)</label>
                        <input type="text" id="parameters" class="form-control" placeholder="Enter ID">
                    </div>
                </div>

                <div class="mb-4">
                    <button id="executeBtn" class="btn btn-primary btn-lg px-5">
                        Execute API Call
                    </button>
                    <button id="clearBtn" class="btn btn-secondary btn-lg px-5 ms-2">
                        Clear Results
                    </button>
                </div>

                <div id="loading" class="alert alert-info" style="display:none;">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    Executing API call...
                </div>

                <div id="error" class="alert alert-danger" style="display:none;"></div>

                <div id="results" style="display:none;">
                    <h5 class="mb-3">Results:</h5>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre id="resultsContent" class="mb-0" style="max-height: 500px; overflow-y: auto; background: white; padding: 15px; border-radius: 5px;"></pre>
                        </div>
                    </div>
                    <div class="mt-3">
                        <span class="badge bg-success" id="resultCount"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Available API Entities</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fw-bold">Core Entities:</h6>
                        <ul>
                            <li><strong>Assets</strong> - Physical assets being inspected</li>
                            <li><strong>Projects</strong> - Work orders/inspection projects</li>
                            <li><strong>Defects</strong> - Findings and issues discovered</li>
                            <li><strong>Measurements</strong> - Quantitative measurements taken</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold">Additional Entities:</h6>
                        <ul>
                            <li><strong>Inspection Media</strong> - Photos, videos, files</li>
                            <li><strong>Checklists</strong> - Digital forms and checklists</li>
                            <li><strong>Users</strong> - User accounts</li>
                            <li><strong>Workspaces</strong> - Workspace information</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#executeBtn').click(function() {
                var entityType = $('#entityType').val();
                var method = $('#method').val();
                var parameters = $('#parameters').val();

                if (!entityType || !method) {
                    alert('Please select both Entity Type and Method');
                    return;
                }

                if (method === 'get' && !parameters) {
                    alert('Please enter an ID for the Get method');
                    return;
                }

                $('#loading').show();
                $('#error').hide();
                $('#results').hide();

                $.ajax({
                    url: '@Url.Action("ExecuteMethod", "Dashboard")',
                    type: 'POST',
                    data: {
                        entityType: entityType,
                        method: method,
                        parameters: parameters
                    },
                    success: function(response) {
                        $('#loading').hide();

                        if (response.success) {
                            $('#results').show();
                            $('#resultsContent').text(JSON.stringify(response.data, null, 2));

                            var count = Array.isArray(response.data) ? response.data.length : 1;
                            $('#resultCount').text(count + ' record(s) returned');
                        } else {
                            $('#error').text('Error: ' + response.error).show();
                        }
                    },
                    error: function(xhr, status, error) {
                        $('#loading').hide();
                        $('#error').text('Request failed: ' + error).show();
                    }
                });
            });

            $('#clearBtn').click(function() {
                $('#results').hide();
                $('#error').hide();
                $('#resultsContent').text('');
            });

            $('#method').change(function() {
                if ($(this).val() === 'get') {
                    $('#parameters').prop('disabled', false);
                } else {
                    $('#parameters').prop('disabled', true).val('');
                }
            });
        });
    </script>
}
